<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Feriados del Mes - Global</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  /* Mantenemos la estética original */
  body {
    background-image: url('https://flagcdn.com/w1600/un.jpg');
    background-size: cover;
    background-attachment: fixed;
    background-position: center;
    color: white;
    text-shadow: 1px 1px 2px #000;
  }
  .bg-overlay {
    background: rgba(0,0,0,0.7);
    min-height: 100vh;
    padding: 2rem;
  }
  .card {
    background: rgba(255,255,255,0.15);
    border: none;
    color: white;
  }
</style>
</head>
<body>
  <div class="bg-overlay">
    <div class="container text-center">
      <h1 class="mb-4">Feriados globales por mes</h1>
      <a href="pais.html" class="btn btn-light mb-4">Ver feriados por país</a>

      <div class="mb-4">
        <label for="mes-selector" class="form-label">Selecciona el mes:</label>
        <select id="mes-selector" class="form-select text-center w-auto mx-auto"></select>
      </div>
      <div id="feriados-globales" class="row g-3 justify-content-center">
        <p>Cargando feriados...</p>
      </div>
    </div>
  </div>

<script>
// --- Variables Globales ---
var contenedor = document.getElementById('feriados-globales');
var mesSelector = document.getElementById('mes-selector');
var anio = new Date().getFullYear();
var nombreMeses = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];

// --- 1. Preparar el Selector de Mes ---
function prepararSelector() {
    // Recorrer la lista de meses para crear las opciones
    for (var i = 0; i < nombreMeses.length; i++) {
        var nombre = nombreMeses[i];
        var valor = i + 1; // 1 para Enero, 2 para Febrero, etc.

        var opcion = document.createElement('option');
        opcion.value = valor;
        opcion.textContent = nombre;
        mesSelector.appendChild(opcion);
    }
    // Seleccionar por defecto el mes actual
    mesSelector.value = new Date().getMonth() + 1;
}

// Función Principal: Cargar Feriados Globales ---
function cargarGlobales() {
    var mesSeleccionado = parseInt(mesSelector.value);

    // 2a. Mostrar mensaje de carga
    contenedor.innerHTML = "<p>Cargando feriados para " + nombreMeses[mesSeleccionado - 1] + "...</p>";

    // 2b. Primer paso: Obtener la lista de países
    fetch('https://date.nager.at/api/v3/AvailableCountries')
        .then(function(res) { return res.json();})
        .then(function(paises) {
            // 2c. Segundo paso: Crear la lista de peticiones 
            var promesasPaises = [];

            for (var i = 0; i < paises.length; i++) {
                var p = paises[i];
                var codigoPais = p.countryCode;
                var nombrePais = p.name;

                // Llamar a la API para cada país
                var promesa = fetch('https://date.nager.at/api/v3/PublicHolidays/' + anio + '/' + codigoPais)
                    .then(function(res) {
                        return res.ok ? res.json() : []; // Devolver lista vacía si falla
                    })
                    .then(function(data) {
                        var feriadosDelMes = [];

                        // Recorrer los feriados del año y quedarnos solo con los del mes seleccionado
                        for (var j = 0; j < data.length; j++) {
                            var f = data[j];
                            // Crear objeto Date para ver el mes
                            var fecha = new Date(f.date);
                            if (fecha.getMonth() + 1 === mesSeleccionado) {
                                // Crear un nuevo objeto con el nombre del país y agregarlo
                                feriadosDelMes.push({
                                    date: f.date,
                                    localName: f.localName,
                                    country: nombrePais // Usamos la variable capturada del ciclo
                                });
                            }
                        }
                        return feriadosDelMes; // Devolver los feriados filtrados
                    })
                    .catch(function(error) {
                          return []; // Si hay un error, devolvemos una lista vacía
                    });

                promesasPaises.push(promesa);
            }

            // 2d. Tercer paso: Esperar que todas las peticiones terminen
            return Promise.all(promesasPaises);
        })
        .then(function(resultados) {
            // 2e. Cuarto paso: Unir y mostrar resultados

            var feriados = [];
            // Unir todos los arrays de feriados en uno solo
            for (var i = 0; i < resultados.length; i++) {
                feriados = feriados.concat(resultados[i]);
            }

            // Ordenar por fecha 
            feriados.sort(function(a, b) {
                return new Date(a.date) - new Date(b.date);
            });

            // Formatear el HTML para mostrar
            var html = "";
            if (feriados.length > 0) {
                for (var i = 0; i < feriados.length; i++) {
                    var f = feriados[i];
                    html += `
                        <div class="col-md-5 col-lg-4">
                          <div class="card p-3">
                            <h5>${f.localName}</h5>
                            <p class="mb-1"><strong>${f.date}</strong></p>
                            <p>${f.country}</p>
                          </div>
                        </div>`;
                }
            } else {
                html = "<p>No se encontraron feriados en el mes seleccionado.</p>";
            }

            contenedor.innerHTML = html;
        })
        .catch(function(error) {
            contenedor.innerHTML = "<p>Error al cargar feriados. Inténtalo de nuevo.</p>";
        });
}

// --- 3. Ejecutar funciones ---
prepararSelector();
mesSelector.addEventListener('change', cargarGlobales);
cargarGlobales(); // Cargar la primera vez al iniciar
</script>
</body>
</html>